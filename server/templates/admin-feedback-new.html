{{define "admin-content"}}
<!-- Page Header -->
<div class="mb-8">
    <h1 class="text-2xl font-bold text-green-brand mb-2">Feedback Overview</h1>
    <p class="text-gray-600 font-sans text-sm">
        What visitors and customers are saying. A simple overview without complex analytics.
    </p>
</div>

<!-- Two Sections -->
<div class="grid md:grid-cols-2 gap-6">

    <!-- Farm Shop Feedback -->
    <div class="bg-white rounded-lg border border-gray-100 shadow-sm">
        <div class="px-5 py-4 border-b border-gray-100">
            <h2 class="text-lg font-bold text-green-brand">Farm Shop Feedback</h2>
            <div class="flex items-center gap-4 mt-2">
                <span class="text-sm text-gray-500 font-sans">{{.FarmShop.Total}} responses</span>
                {{if .FarmShop.LatestDate}}
                <span class="text-xs text-gray-400 font-sans">Latest: {{.FarmShop.LatestDate}}</span>
                {{end}}
            </div>
        </div>

        <div class="divide-y divide-gray-100">
            {{range .FarmShop.Samples}}
            <div class="px-5 py-4 feedback-card">
                <div class="flex justify-between items-start">
                    <div class="flex items-center gap-2 mb-2">
                        {{range iterate .Rating}}
                        <span class="text-yellow-400">★</span>
                        {{end}}
                        {{range iterate (minus 5 .Rating)}}
                        <span class="text-gray-200">★</span>
                        {{end}}
                    </div>

                    <!-- Status Area (Visible if Published) -->
                    <div class="status-area flex items-center gap-1 {{if not .Published}}hidden{{end}}">
                        <span
                            class="px-2 py-0.5 rounded text-[10px] font-bold bg-green-100 text-green-700 uppercase">Published</span>
                        <button onclick="toggleFeedback(this)"
                            class="text-red-400 hover:text-red-600 p-0.5 rounded-full hover:bg-red-50 transition-colors"
                            title="Unpublish">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <p class="text-gray-600 font-sans text-sm italic">"{{.Comment}}"</p>
                <div class="flex gap-2 mt-1">
                    <span class="text-xs text-gray-400 font-sans">{{.Name}}</span>
                    <span class="text-xs text-gray-300 font-sans">{{.Country}}</span>
                </div>
                <div class="flex items-center justify-between mt-2">
                    <span class="text-xs text-gray-400 font-sans">{{.Date}}</span>
                    <!-- Publish Button (Visible if NOT Published) -->
                    <button onclick="toggleFeedback(this)"
                        class="publish-btn text-xs font-semibold text-green-600 hover:text-green-800 {{if .Published}}hidden{{end}}">
                        Publish
                    </button>
                </div>
            </div>
            {{else}}
            <div class="px-5 py-8 text-center text-gray-400 font-sans text-sm">
                No farm shop feedback yet
            </div>
            {{end}}
        </div>
    </div>

    <!-- Experience Feedback -->
    <div class="bg-white rounded-lg border border-gray-100 shadow-sm">
        <div class="px-5 py-4 border-b border-gray-100">
            <h2 class="text-lg font-bold text-green-brand">Experience Feedback</h2>
            <div class="flex items-center gap-4 mt-2">
                <span class="text-sm text-gray-500 font-sans">{{.Experience.Total}} responses</span>
                {{if .Experience.LatestDate}}
                <span class="text-xs text-gray-400 font-sans">Latest: {{.Experience.LatestDate}}</span>
                {{end}}
            </div>
        </div>

        <div class="divide-y divide-gray-100">
            {{range .Experience.Samples}}
            <div class="px-5 py-4 feedback-card">
                <div class="flex justify-between items-start">
                    <div class="flex items-center gap-2 mb-2">
                        {{range iterate .Rating}}
                        <span class="text-yellow-400">★</span>
                        {{end}}
                        {{range iterate (minus 5 .Rating)}}
                        <span class="text-gray-200">★</span>
                        {{end}}
                        <span class="text-xs text-gray-400 font-sans ml-2">{{.Experience}}</span>
                    </div>

                    <!-- Status Area (Visible if Published) -->
                    <div class="status-area flex items-center gap-1 {{if not .Published}}hidden{{end}}">
                        <span
                            class="px-2 py-0.5 rounded text-[10px] font-bold bg-green-100 text-green-700 uppercase">Published</span>
                        <button onclick="toggleFeedback(this)"
                            class="text-red-400 hover:text-red-600 p-0.5 rounded-full hover:bg-red-50 transition-colors"
                            title="Unpublish">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <p class="text-gray-600 font-sans text-sm italic">"{{.Comment}}"</p>
                <div class="flex gap-2 mt-1">
                    <span class="text-xs text-gray-400 font-sans">{{.Name}}</span>
                    <span class="text-xs text-gray-300 font-sans">{{.Country}}</span>
                </div>
                <div class="flex items-center justify-between mt-2">
                    <span class="text-xs text-gray-400 font-sans">{{.Date}}</span>
                    <!-- Publish Button (Visible if NOT Published) -->
                    <button onclick="toggleFeedback(this)"
                        class="publish-btn text-xs font-semibold text-green-600 hover:text-green-800 {{if .Published}}hidden{{end}}">
                        Publish
                    </button>
                </div>
            </div>
            {{else}}
            <div class="px-5 py-8 text-center text-gray-400 font-sans text-sm">
                No experience feedback yet
            </div>
            {{end}}
        </div>
    </div>
</div>

<p class="mt-6 text-xs text-gray-400 font-sans text-center">
    Feedback is collected through the survey forms at /feedback/farmshop and /feedback/experience
</p>

<script>
    function toggleFeedback(btn) {
        const card = btn.closest('.feedback-card');
        const statusArea = card.querySelector('.status-area');
        const publishBtn = card.querySelector('.publish-btn');

        // Check which way we are going
        // If we clicked the status area button (X), we are unpublishing
        // If we clicked the publish button, we are publishing

        if (statusArea.contains(btn)) {
            // Unpublish action: Hide status area, Show publish button
            statusArea.classList.add('hidden');
            publishBtn.classList.remove('hidden');
            console.log("Unpublished item");
        } else {
            // Publish action: Show status area, Hide publish button
            statusArea.classList.remove('hidden');
            publishBtn.classList.add('hidden');
            console.log("Published item");
        }

        // In a real app, send API request here
    }
</script>
{{end}}