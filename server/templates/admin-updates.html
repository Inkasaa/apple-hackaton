{{define "admin-content"}}
<!-- Page Header -->
<div class="mb-8">
    <h1 class="text-2xl font-bold text-green-brand mb-2">Newsletters</h1>
    <p class="text-gray-600 font-sans text-sm">
        Updates and newsletters shared with different audiences. 
        These can be sent as emails or shown on relevant pages.
    </p>
</div>

<!-- Filters Section -->
<div class="bg-warm rounded-lg p-4 mb-6">
    <!-- Audience Filter -->
    <div class="mb-4">
        <label class="text-xs font-sans text-gray-500 uppercase tracking-wide mb-2 block">Audience</label>
        <div class="flex flex-wrap gap-2">
            <button onclick="setFilter('audience', 'all')" data-filter-type="audience" data-filter-value="all" class="filter-btn audience-filter active px-3 py-1.5 text-xs font-sans rounded-full border border-gray-200 bg-white text-gray-600 hover:border-green-brand hover:text-green-brand transition-colors">
                All
            </button>
            <button onclick="setFilter('audience', 'adopters')" data-filter-type="audience" data-filter-value="adopters" class="filter-btn audience-filter px-3 py-1.5 text-xs font-sans rounded-full border border-gray-200 bg-white text-gray-600 hover:border-green-600 hover:text-green-600 transition-colors">
                üçé Tree Adopters
            </button>
            <button onclick="setFilter('audience', 'subscribers')" data-filter-type="audience" data-filter-value="subscribers" class="filter-btn audience-filter px-3 py-1.5 text-xs font-sans rounded-full border border-gray-200 bg-white text-gray-600 hover:border-blue-600 hover:text-blue-600 transition-colors">
                Subscribers
            </button>
            <button onclick="setFilter('audience', 'safari')" data-filter-type="audience" data-filter-value="safari" class="filter-btn audience-filter px-3 py-1.5 text-xs font-sans rounded-full border border-gray-200 bg-white text-gray-600 hover:border-amber-600 hover:text-amber-600 transition-colors">
                Safari Guests
            </button>
            <button onclick="setFilter('audience', 'tasting')" data-filter-type="audience" data-filter-value="tasting" class="filter-btn audience-filter px-3 py-1.5 text-xs font-sans rounded-full border border-gray-200 bg-white text-gray-600 hover:border-purple-600 hover:text-purple-600 transition-colors">
                Tasting Guests
            </button>
        </div>
    </div>

    <!-- Status and Date Filters -->
    <div class="flex flex-wrap gap-6">
        <!-- Status Filter -->
        <div>
            <label class="text-xs font-sans text-gray-500 uppercase tracking-wide mb-2 block">Status</label>
            <div class="flex gap-2">
                <button onclick="setFilter('status', 'all')" data-filter-type="status" data-filter-value="all" class="filter-btn status-filter active px-3 py-1.5 text-xs font-sans rounded-full border border-gray-200 bg-white text-gray-600 hover:border-green-brand hover:text-green-brand transition-colors">
                    All
                </button>
                <button onclick="setFilter('status', 'published')" data-filter-type="status" data-filter-value="published" class="filter-btn status-filter px-3 py-1.5 text-xs font-sans rounded-full border border-gray-200 bg-white text-gray-600 hover:border-green-600 hover:text-green-600 transition-colors">
                    Published
                </button>
                <button onclick="setFilter('status', 'draft')" data-filter-type="status" data-filter-value="draft" class="filter-btn status-filter px-3 py-1.5 text-xs font-sans rounded-full border border-gray-200 bg-white text-gray-600 hover:border-yellow-600 hover:text-yellow-600 transition-colors">
                    Draft
                </button>
            </div>
        </div>

        <!-- Date Filter -->
        <div class="flex-1">
            <label class="text-xs font-sans text-gray-500 uppercase tracking-wide mb-2 block">Date Range</label>
            <div class="flex items-center gap-2">
                <input type="date" id="date-from" onchange="applyFilters()" 
                    class="px-3 py-1.5 text-xs font-sans rounded-lg border border-gray-200 bg-white text-gray-600 focus:border-green-brand focus:outline-none">
                <span class="text-gray-400 text-xs">to</span>
                <input type="date" id="date-to" onchange="applyFilters()" 
                    class="px-3 py-1.5 text-xs font-sans rounded-lg border border-gray-200 bg-white text-gray-600 focus:border-green-brand focus:outline-none">
                <button onclick="clearDateRange()" class="px-3 py-1.5 text-xs font-sans rounded-full border border-gray-200 bg-white text-gray-400 hover:text-gray-600 hover:border-gray-300 transition-colors">
                    Clear
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Updates List -->
<div class="bg-white rounded-lg border border-gray-100 shadow-sm">
    <div class="px-5 py-4 border-b border-gray-100 flex justify-end items-center">
        <span id="result-count" class="text-xs text-gray-400 font-sans"></span>
    </div>
    <div id="updates-list" class="divide-y divide-gray-100">
        {{range .Updates}}
        <div class="update-item px-5 py-4 hover:bg-warm transition-colors" data-audience="{{.Audience}}" data-status="{{.Status}}" data-date="{{.Date}}">
            <div class="flex items-start justify-between gap-4">
                <div class="flex-1">
                    <div class="flex items-center gap-3 mb-2">
                        <h3 class="font-semibold text-gray-800 font-sans text-sm">{{.Title}}</h3>
                        {{if eq .Status "published"}}
                        <span class="text-xs px-2 py-0.5 rounded-full bg-green-100 text-green-700 font-sans">Published</span>
                        {{else}}
                        <span class="text-xs px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-700 font-sans">Draft</span>
                        {{end}}
                    </div>
                    <p class="text-gray-600 font-sans text-sm mb-2 line-clamp-2">{{.Preview}}</p>
                    <div class="flex items-center gap-4">
                        <span class="text-xs text-gray-400 font-sans">{{.Date}}</span>
                        <span class="text-xs px-2 py-0.5 rounded-full font-sans
                            {{if eq .Audience "adopters"}}bg-green-50 text-green-600
                            {{else if eq .Audience "subscribers"}}bg-blue-50 text-blue-600
                            {{else if eq .Audience "safari"}}bg-amber-50 text-amber-600
                            {{else if eq .Audience "tasting"}}bg-purple-50 text-purple-600
                            {{else}}bg-gray-50 text-gray-600{{end}}">
                            {{if eq .Audience "adopters"}}üçé Tree Adopters
                            {{else if eq .Audience "subscribers"}}Subscribers
                            {{else if eq .Audience "safari"}}Safari Guests
                            {{else if eq .Audience "tasting"}}Tasting Guests
                            {{else}}All{{end}}
                        </span>
                    </div>
                </div>
            </div>
        </div>
        {{else}}
        <div class="px-5 py-8 text-center text-gray-400 font-sans text-sm">
            No updates yet
        </div>
        {{end}}
    </div>
    
    <!-- No results message (hidden by default) -->
    <div id="no-results" class="hidden px-5 py-8 text-center text-gray-400 font-sans text-sm">
        No newsletters match your filters
    </div>
</div>

<p class="mt-6 text-xs text-gray-400 font-sans text-center">
    Newsletters are currently managed by editing the server code. A content editor could be added later.
</p>

<script>
// Current filter state
const filters = {
    audience: 'all',
    status: 'all'
};

function setFilter(type, value) {
    filters[type] = value;
    
    // Update button states for this filter type
    const buttons = document.querySelectorAll(`.${type}-filter`);
    buttons.forEach(btn => {
        btn.classList.remove('active', 'bg-green-brand', 'text-white', 'border-green-brand');
        if (btn.dataset.filterValue === value) {
            btn.classList.add('active', 'bg-green-brand', 'text-white', 'border-green-brand');
        }
    });
    
    applyFilters();
}

function clearDateRange() {
    document.getElementById('date-from').value = '';
    document.getElementById('date-to').value = '';
    applyFilters();
}

function parseDate(dateStr) {
    // Parse dates like "Jan 10, 2026" into a Date object
    const months = {
        'Jan': 0, 'Feb': 1, 'Mar': 2, 'Apr': 3, 'May': 4, 'Jun': 5,
        'Jul': 6, 'Aug': 7, 'Sep': 8, 'Oct': 9, 'Nov': 10, 'Dec': 11
    };
    const parts = dateStr.match(/(\w+)\s+(\d+),\s+(\d+)/);
    if (parts) {
        return new Date(parseInt(parts[3]), months[parts[1]], parseInt(parts[2]));
    }
    return null;
}

function applyFilters() {
    const items = document.querySelectorAll('.update-item');
    const noResults = document.getElementById('no-results');
    const resultCount = document.getElementById('result-count');
    
    const dateFrom = document.getElementById('date-from').value;
    const dateTo = document.getElementById('date-to').value;
    const fromDate = dateFrom ? new Date(dateFrom) : null;
    const toDate = dateTo ? new Date(dateTo) : null;
    
    let visibleCount = 0;
    
    items.forEach(item => {
        const matchesAudience = filters.audience === 'all' || item.dataset.audience === filters.audience;
        const matchesStatus = filters.status === 'all' || item.dataset.status === filters.status;
        
        // Date range check
        let matchesDate = true;
        if (fromDate || toDate) {
            const itemDate = parseDate(item.dataset.date);
            if (itemDate) {
                if (fromDate && itemDate < fromDate) matchesDate = false;
                if (toDate && itemDate > toDate) matchesDate = false;
            }
        }
        
        if (matchesAudience && matchesStatus && matchesDate) {
            item.classList.remove('hidden');
            visibleCount++;
        } else {
            item.classList.add('hidden');
        }
    });
    
    // Update result count
    const total = items.length;
    if (visibleCount === total) {
        resultCount.textContent = `${total} newsletters`;
    } else {
        resultCount.textContent = `${visibleCount} of ${total} newsletters`;
    }
    
    // Show/hide no results message
    if (visibleCount === 0) {
        noResults.classList.remove('hidden');
    } else {
        noResults.classList.add('hidden');
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', applyFilters);
</script>

<style>
.filter-btn.active {
    background-color: #4a6741;
    color: white;
    border-color: #4a6741;
}
</style>
{{end}}
