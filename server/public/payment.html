<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment - √ñfverg√•rds</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #fdfbf7;
            font-family: 'Georgia', serif;
        }

        .font-sans {
            font-family: system-ui, -apple-system, sans-serif;
        }

        .btn-primary {
            background-color: #4a6741;
            color: white;
        }

        .btn-primary:hover {
            background-color: #3d5535;
        }

        .btn-outline {
            border: 2px solid #4a6741;
            color: #4a6741;
        }

        .btn-outline:hover {
            background-color: #4a6741;
            color: white;
        }

        .text-green-brand {
            color: #4a6741;
        }

        .bg-green-brand {
            background-color: #4a6741;
        }

        .bg-warm {
            background-color: #f9f6f1;
        }

        .bg-warm-dark {
            background-color: #f0ebe3;
        }
    </style>
</head>

<body class="text-gray-800 min-h-screen flex flex-col">
    <!-- Navigation -->
    <nav class="bg-white/80 backdrop-blur-sm sticky top-0 z-50 border-b border-gray-100">
        <div class="max-w-5xl mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <a href="/" class="text-xl font-bold text-green-brand">
                    üçé √ñfverg√•rds
                </a>

                <!-- Mobile menu button -->
                <button id="menuBtn" class="md:hidden p-2 text-gray-600" onclick="toggleMenu()">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center gap-6">
                    <a href="/"
                        class="text-sm font-sans text-gray-600 hover:text-green-brand transition-colors">Home</a>
                    <a href="/products"
                        class="text-sm font-sans text-gray-600 hover:text-green-brand transition-colors">Products</a>
                    <a href="/adopt.html"
                        class="text-sm font-sans text-green-brand font-medium hover:text-green-brand transition-colors">Adopt
                        a Tree</a>
                    <a href="/feedback/farmshop"
                        class="text-sm font-sans text-gray-600 hover:text-green-brand transition-colors">Feedback</a>
                    <a href="/admin.html"
                        class="text-sm font-sans text-gray-400 hover:text-gray-600 transition-colors">Admin</a>
                </div>
            </div>

            <!-- Mobile Navigation -->
            <div id="mobileMenu" class="hidden md:hidden pt-4 pb-2 border-t mt-4">
                <div class="flex flex-col gap-3">
                    <a href="/" class="text-sm font-sans text-gray-600 hover:text-green-brand">Home</a>
                    <a href="/products" class="text-sm font-sans text-gray-600 hover:text-green-brand">Products</a>
                    <a href="/adopt.html"
                        class="text-sm font-sans text-green-brand font-medium hover:text-green-brand">Adopt a Tree</a>
                    <a href="/feedback/farmshop"
                        class="text-sm font-sans text-gray-600 hover:text-green-brand">Feedback</a>
                    <a href="/admin.html" class="text-sm font-sans text-gray-400 hover:text-gray-600">Admin</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1">
        <div class="max-w-xl mx-auto p-6">
            <!-- Progress Steps -->
            <div class="flex items-center justify-center mb-8 mt-4">
                <div class="flex items-center">
                    <div
                        class="w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center text-sm font-bold font-sans">
                        ‚úì</div>
                    <span class="ml-2 text-sm text-green-700 font-medium font-sans">Sign Up</span>
                </div>
                <div class="w-12 h-1 bg-green-600 mx-2"></div>
                <div class="flex items-center">
                    <div
                        class="w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center text-sm font-bold font-sans">
                        2</div>
                    <span class="ml-2 text-sm text-green-700 font-medium font-sans">Payment</span>
                </div>
                <div class="w-12 h-1 bg-gray-300 mx-2"></div>
                <div class="flex items-center">
                    <div
                        class="w-8 h-8 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center text-sm font-bold font-sans">
                        3</div>
                    <span class="ml-2 text-sm text-gray-500 font-sans">Complete</span>
                </div>
            </div>

            <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-100">
                <!-- Mock Payment Form -->
                <div id="paymentForm">
                    <h2 class="text-2xl font-bold mb-6 text-center text-green-brand">Complete Your Adoption</h2>

                    <!-- Order Summary -->
                    <div class="bg-green-50 p-4 rounded-lg mb-6 border border-green-100">
                        <h3 class="font-semibold text-green-800 mb-2 font-sans">Order Summary</h3>
                        <div class="flex justify-between text-sm font-sans">
                            <span>Apple Tree Adoption (<span id="treeTypeDisplay">-</span>)</span>
                            <span class="font-medium">‚Ç¨<span id="amountDisplay">0.00</span></span>
                        </div>
                        <div class="flex justify-between text-sm mt-1 text-gray-500 font-sans">
                            <span>Adopter: <span id="nameDisplay">-</span></span>
                        </div>
                        <div
                            class="border-t border-green-200 mt-3 pt-3 flex justify-between font-bold text-green-800 font-sans">
                            <span>Total</span>
                            <span>‚Ç¨<span id="totalDisplay">0.00</span></span>
                        </div>
                    </div>

                    <!-- Mock Card Input -->
                    <div class="space-y-4 mb-6">
                        <div
                            class="bg-yellow-50 border border-yellow-200 p-3 rounded-lg text-sm text-yellow-800 font-sans">
                            <strong>Demo Mode:</strong> This is a simulated payment. No real charges will be made.
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-1 font-sans">Card Number</label>
                            <input type="text" value="4242 4242 4242 4242" disabled
                                class="w-full border p-3 rounded bg-gray-50 text-gray-500 font-sans">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1 font-sans">Expiry</label>
                                <input type="text" value="12/28" disabled
                                    class="w-full border p-3 rounded bg-gray-50 text-gray-500 font-sans">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1 font-sans">CVC</label>
                                <input type="text" value="123" disabled
                                    class="w-full border p-3 rounded bg-gray-50 text-gray-500 font-sans">
                            </div>
                        </div>
                    </div>

                    <button id="payBtn" onclick="processPayment()"
                        class="w-full btn-primary py-4 rounded-lg font-semibold transition-all shadow-md text-lg font-sans">
                        Pay ‚Ç¨<span id="btnTotalDisplay">0.00</span> (Simulated)
                    </button>
                </div>

                <!-- Processing State -->
                <div id="processingState" class="hidden text-center py-8">
                    <div
                        class="animate-spin w-12 h-12 border-4 border-green-200 border-t-green-600 rounded-full mx-auto mb-4">
                    </div>
                    <p class="text-lg text-gray-600 font-sans">Processing payment...</p>
                    <p class="text-sm text-gray-400 mt-2 font-sans">This is simulated and takes 2 seconds</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-warm-dark border-t border-gray-200 mt-16">
        <div class="max-w-5xl mx-auto px-6 py-12">
            <div class="text-center">
                <p class="text-green-brand font-bold text-lg mb-2">√ñfverg√•rds</p>
                <p class="text-sm text-gray-500 font-sans">√Öland archipelago, Finland</p>
                <p class="text-xs text-gray-400 font-sans mt-4">
                    A small family farm sharing nature, apples, and quiet moments.
                </p>
            </div>
        </div>
    </footer>

    <script>
        function toggleMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('hidden');
        }

        // Get customer data from URL params (passed from form)
        const params = new URLSearchParams(window.location.search);
        const customerId = params.get('id');
        const customerName = params.get('name');
        const treeType = params.get('tree');
        const amount = params.get('amount') || '50.00';
        const paymentType = params.get('type'); // 'visit' or null (adopt)

        // Display customer info
        document.getElementById('nameDisplay').textContent = customerName || 'Guest';
        document.getElementById('treeTypeDisplay').textContent = treeType || 'Apple Tree';
        document.getElementById('amountDisplay').textContent = amount;
        document.getElementById('totalDisplay').textContent = amount;
        document.getElementById('btnTotalDisplay').textContent = amount;

        async function processPayment() {
            const paymentForm = document.getElementById('paymentForm');
            const processingState = document.getElementById('processingState');

            // Show processing state
            paymentForm.classList.add('hidden');
            processingState.classList.remove('hidden');

            // MOCK: Simulate payment processing delay (2 seconds)
            await new Promise(resolve => setTimeout(resolve, 2000));

            // MOCK: Call backend to confirm "payment"
            try {
                let url = '/api/confirm-payment';
                let body = { customerId: parseInt(customerId) };

                if (paymentType === 'visit') {
                    url = '/api/confirm-visit';
                    body = { bookingId: parseInt(customerId) };
                }

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                const result = await response.json();
                if (result.success) {
                    // Redirect to success page with customer info
                    window.location.href = `/success.html?id=${customerId}&name=${encodeURIComponent(customerName)}`;
                } else {
                    alert('Payment simulation failed. Please try again.');
                    paymentForm.classList.remove('hidden');
                    processingState.classList.add('hidden');
                }
            } catch (err) {
                console.error(err);
                alert('Error connecting to server.');
                paymentForm.classList.remove('hidden');
                processingState.classList.add('hidden');
            }
        }
    </script>
</body>

</html>