<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment - √ñfverg√•rds</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #fdfbf7;
            font-family: 'Georgia', serif;
        }

        .font-sans {
            font-family: system-ui, -apple-system, sans-serif;
        }

        .btn-primary {
            background-color: #4a6741;
            color: white;
        }

        .btn-primary:hover {
            background-color: #3d5535;
        }

        .btn-outline {
            border: 2px solid #4a6741;
            color: #4a6741;
        }

        .btn-outline:hover {
            background-color: #4a6741;
            color: white;
        }

        .text-green-brand {
            color: #4a6741;
        }

        .bg-green-brand {
            background-color: #4a6741;
        }

        .bg-warm {
            background-color: #f9f6f1;
        }

        .bg-warm-dark {
            background-color: #f0ebe3;
        }
    </style>
</head>

<body class="text-gray-800 min-h-screen flex flex-col">
    <!-- Navigation -->
    <nav id="simpleHeader" class="bg-white/80 backdrop-blur-sm sticky top-0 z-50 border-b border-gray-100">
        <div class="max-w-5xl mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <a href="/" class="text-xl font-bold text-green-brand">
                    üçé √ñfverg√•rds
                </a>

                <!-- Mobile menu button -->
                <button id="menuBtn" class="md:hidden p-2 text-gray-600" onclick="toggleMenu()">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center gap-6">
                    <a href="/"
                        class="text-sm font-sans text-gray-600 hover:text-green-brand transition-colors">Home</a>
                </div>
            </div>

            <!-- Mobile Navigation -->
            <div id="mobileMenu" class="hidden md:hidden pt-4 pb-2 border-t mt-4">
                <div class="flex flex-col gap-3">
                    <a href="/" class="text-sm font-sans text-gray-600 hover:text-green-brand">Home</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Navigation: Original Mode (Replica) -->
    <nav id="originalHeader" class="hidden sticky top-0 z-50"
        style="background-color: #751C1E; font-family: system-ui, sans-serif;">
        <div class="mx-auto px-4 py-4">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <!-- Logo -->
                <div class="flex-shrink-0">
                    <a href="/">
                        <img src="https://i0.wp.com/ofvergards.ax/wp-content/uploads/2020/08/%C3%96fverg%C3%A5rds_logo.png?fit=557%2C600&ssl=1"
                            alt="√ñfverg√•rds" class="h-16 w-auto">
                    </a>
                </div>

                <!-- Desktop Links (Mirrored) -->
                <div
                    class="hidden md:flex flex-wrap justify-center gap-6 text-sm uppercase font-bold tracking-wide text-white">
                    <a href="/"
                        class="hover:text-gray-200 hover:underline decoration-[#D85F31] decoration-[3px] underline-offset-[6px] transition-colors">Start</a>
                    <a href="/om-oss/"
                        class="hover:text-gray-200 hover:underline decoration-[#D85F31] decoration-[3px] underline-offset-[6px] transition-colors">Om
                        oss</a>
                    <a href="/gardsbesok/"
                        class="hover:text-gray-200 hover:underline decoration-[#D85F31] decoration-[3px] underline-offset-[6px] transition-colors">G√•rdsbes√∂k</a>
                    <a href="/vara-produkter/"
                        class="hover:text-gray-200 hover:underline decoration-[#D85F31] decoration-[3px] underline-offset-[6px] transition-colors">V√•ra
                        produkter</a>
                    <a href="/mitt-appeltrad/index.html"
                        class="hover:text-gray-200 hover:underline decoration-[#D85F31] decoration-[3px] underline-offset-[6px] transition-colors">Mitt
                        √§ppeltr√§d</a>
                    <a href="/kontakta-oss/"
                        class="hover:text-gray-200 hover:underline decoration-[#D85F31] decoration-[3px] underline-offset-[6px] transition-colors">Kontakta
                        oss</a>
                </div>
                <div class="md:hidden text-white text-xs uppercase tracking-widest">
                    MENU
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1">
        <div class="max-w-xl mx-auto p-6">
            <!-- Progress Steps -->
            <div class="flex items-center justify-center mb-8 mt-4">
                <div class="flex items-center">
                    <div
                        class="w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center text-sm font-bold font-sans">
                        ‚úì</div>
                    <span class="ml-2 text-sm text-green-700 font-medium font-sans">Sign Up</span>
                </div>
                <div class="w-12 h-1 bg-green-600 mx-2"></div>
                <div class="flex items-center">
                    <div
                        class="w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center text-sm font-bold font-sans">
                        2</div>
                    <span class="ml-2 text-sm text-green-700 font-medium font-sans">Payment</span>
                </div>
                <div class="w-12 h-1 bg-gray-300 mx-2"></div>
                <div class="flex items-center">
                    <div
                        class="w-8 h-8 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center text-sm font-bold font-sans">
                        3</div>
                    <span class="ml-2 text-sm text-gray-500 font-sans">Complete</span>
                </div>
            </div>

            <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-100">
                <!-- Mock Payment Form -->
                <div id="paymentForm">
                    <h2 class="text-2xl font-bold mb-6 text-center text-green-brand"><span
                            id="pageTitleDisplay">Complete Payment</span></h2>

                    <!-- Order Summary -->
                    <div class="bg-green-50 p-4 rounded-lg mb-6 border border-green-100">
                        <h3 class="font-semibold text-green-800 mb-2 font-sans">Order Summary</h3>
                        <div class="flex justify-between text-sm font-sans">
                            <span><span id="itemLabelDisplay">Item</span> (<span id="variantDisplay">-</span>)</span>
                            <span class="font-medium">‚Ç¨<span id="amountDisplay">0.00</span></span>
                        </div>
                        <div class="flex justify-between text-sm mt-1 text-gray-500 font-sans">
                            <span>Customer: <span id="nameDisplay">-</span></span>
                        </div>

                        <!-- Promo Code Section -->
                        <div class="mt-4 pt-3 border-t border-green-200">
                            <div class="flex gap-2">
                                <input type="text" id="promoCodeInput" placeholder="Promo Code"
                                    class="border border-green-300 rounded px-2 py-1 text-sm w-full font-sans focus:outline-none focus:border-green-500 uppercase">
                                <button onclick="applyPromoCode()"
                                    class="bg-green-600 text-white text-xs px-3 py-1 rounded hover:bg-green-700 font-sans">Apply</button>
                            </div>
                            <p id="promoMessage" class="text-xs mt-1 hidden"></p>
                        </div>

                        <div
                            class="border-t border-green-200 mt-3 pt-3 flex justify-between font-bold text-green-800 font-sans">
                            <span>Total</span>
                            <div class="text-right">
                                <span id="originalPriceDisplay"
                                    class="text-xs text-gray-400 line-through mr-1 hidden"></span>
                                <span>‚Ç¨<span id="totalDisplay">0.00</span></span>
                            </div>
                        </div>
                    </div>

                    <!-- Mock Card Input -->
                    <div class="space-y-4 mb-6">
                        <div
                            class="bg-yellow-50 border border-yellow-200 p-3 rounded-lg text-sm text-yellow-800 font-sans">
                            <strong>Demo Mode:</strong> This is a simulated payment. No real charges will be made.
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-1 font-sans">Card Number</label>
                            <input type="text" value="4242 4242 4242 4242" disabled
                                class="w-full border p-3 rounded bg-gray-50 text-gray-500 font-sans">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1 font-sans">Expiry</label>
                                <input type="text" value="12/28" disabled
                                    class="w-full border p-3 rounded bg-gray-50 text-gray-500 font-sans">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1 font-sans">CVC</label>
                                <input type="text" value="123" disabled
                                    class="w-full border p-3 rounded bg-gray-50 text-gray-500 font-sans">
                            </div>
                        </div>
                    </div>

                    <button id="payBtn" onclick="processPayment()"
                        class="w-full btn-primary py-4 rounded-lg font-semibold transition-all shadow-md text-lg font-sans">
                        Pay ‚Ç¨<span id="btnTotalDisplay">0.00</span> (Simulated)
                    </button>
                </div>

                <!-- Processing State -->
                <div id="processingState" class="hidden text-center py-8">
                    <div
                        class="animate-spin w-12 h-12 border-4 border-green-200 border-t-green-600 rounded-full mx-auto mb-4">
                    </div>
                    <p class="text-lg text-gray-600 font-sans">Processing payment...</p>
                    <p class="text-sm text-gray-400 mt-2 font-sans">This is simulated and takes 2 seconds</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-warm-dark border-t border-gray-200 mt-16">
        <div class="max-w-5xl mx-auto px-6 py-12">
            <div class="text-center">
                <p class="text-green-brand font-bold text-lg mb-2">√ñfverg√•rds</p>
                <p class="text-sm text-gray-500 font-sans">√Öland archipelago, Finland</p>
                <p class="text-xs text-gray-400 font-sans mt-4">
                    A small family farm sharing nature, apples, and quiet moments.
                </p>
            </div>
        </div>
    </footer>

    <!-- Header Switcher Toggle -->
    <button id="headerToggleBtn" onclick="toggleHeaderMode()"
        class="fixed bottom-4 right-4 bg-white border border-gray-200 shadow-lg p-3 rounded-full text-xs text-gray-500 hover:bg-gray-50 z-50 pointer-events-auto transition-transform hover:scale-110"
        title="Switch Style">
        üîÑ
    </button>

    <script>
        function toggleMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('hidden');
        }

        // Header Switch Logic
        function toggleHeaderMode() {
            const simpleHeader = document.getElementById('simpleHeader');
            const originalHeader = document.getElementById('originalHeader');

            if (simpleHeader.classList.contains('hidden')) {
                // Switch to Simple
                simpleHeader.classList.remove('hidden');
                originalHeader.classList.add('hidden');
                localStorage.setItem('headerMode', 'simple');
            } else {
                // Switch to Original
                simpleHeader.classList.add('hidden');
                originalHeader.classList.remove('hidden');
                localStorage.setItem('headerMode', 'original');
            }
        }

        // Init Header Mode
        document.addEventListener('DOMContentLoaded', () => {
            const mode = localStorage.getItem('headerMode');
            if (mode === 'original') {
                document.getElementById('simpleHeader').classList.add('hidden');
                document.getElementById('originalHeader').classList.remove('hidden');
            }
        });

        // Get customer data from URL params (passed from form)
        const params = new URLSearchParams(window.location.search);
        const customerId = params.get('id');
        const customerName = params.get('name');
        const variant = params.get('tree') || params.get('item') || 'Standard'; // Support generic 'item' param or fallback to 'tree'
        let amount = parseFloat(params.get('amount') || '50.00');
        const paymentType = params.get('type'); // 'visit' or null (adopt)

        // Promo Code Logic
        const promoCodes = {
            'APPLE20': 0.20, // 20% off
            'VISIT10': 0.10,  // 10% off
            'HACKATON': 0.50  // 50% off
        };
        let currentDiscount = 0;

        // Setup UI based on Type
        if (paymentType === 'visit') {
            document.getElementById('pageTitleDisplay').textContent = "Complete Booking";
            document.getElementById('itemLabelDisplay').textContent = "Farm Visit";
            // For visits, the 'variant' might be the tree type they visited or just generic
        } else {
            document.getElementById('pageTitleDisplay').textContent = "Complete Adoption";
            document.getElementById('itemLabelDisplay').textContent = "Tree Adoption";
        }

        // Display customer info
        document.getElementById('nameDisplay').textContent = customerName || 'Guest';
        document.getElementById('variantDisplay').textContent = variant;

        // Initial Price Display
        updatePriceDisplay(amount);

        function updatePriceDisplay(currentTotal) {
            document.getElementById('amountDisplay').textContent = amount.toFixed(2); // Base amount always shows original? Or maybe we just update total.

            // If discount applied, show strikethrough logic could be complex if we want to show base price vs discounted total separately.
            // For simplicity, let's keep Base Item Price static, and update Total.

            let finalTotal = currentTotal;
            if (currentDiscount > 0) {
                finalTotal = amount * (1 - currentDiscount);
                document.getElementById('originalPriceDisplay').textContent = "‚Ç¨" + amount.toFixed(2);
                document.getElementById('originalPriceDisplay').classList.remove('hidden');
            } else {
                document.getElementById('originalPriceDisplay').classList.add('hidden');
            }

            document.getElementById('totalDisplay').textContent = finalTotal.toFixed(2);
            document.getElementById('btnTotalDisplay').textContent = finalTotal.toFixed(2);
        }

        function applyPromoCode() {
            const input = document.getElementById('promoCodeInput');
            const msg = document.getElementById('promoMessage');
            const code = input.value.trim().toUpperCase();

            if (promoCodes.hasOwnProperty(code)) {
                currentDiscount = promoCodes[code];
                msg.textContent = `Promo code applied: ${(currentDiscount * 100)}% Discount!`;
                msg.classList.remove('hidden');
                msg.classList.remove('text-red-500');
                msg.classList.add('text-green-600');
                updatePriceDisplay(amount); // Recalculate
            } else {
                currentDiscount = 0;
                msg.textContent = "Invalid promo code.";
                msg.classList.remove('hidden');
                msg.classList.remove('text-green-600');
                msg.classList.add('text-red-500');
                updatePriceDisplay(amount); // Reset
            }
        }

        async function processPayment() {
            const paymentForm = document.getElementById('paymentForm');
            const processingState = document.getElementById('processingState');

            // Show processing state
            paymentForm.classList.add('hidden');
            processingState.classList.remove('hidden');

            // MOCK: Simulate payment processing delay (2 seconds)
            await new Promise(resolve => setTimeout(resolve, 2000));

            // MOCK: Call backend to confirm "payment"
            try {
                let url = '/api/confirm-payment';
                // Pass final amount if needed, though mostly ID matters for mock
                let body = {
                    customerId: parseInt(customerId),
                    amountPaid: parseFloat(document.getElementById('totalDisplay').textContent)
                };

                if (paymentType === 'visit') {
                    url = '/api/confirm-visit';
                    body = {
                        bookingId: parseInt(customerId),
                        amountPaid: parseFloat(document.getElementById('totalDisplay').textContent)
                    };
                }

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                const result = await response.json();
                if (result.success) {
                    // Redirect to success page with customer info
                    window.location.href = `/success.html?id=${customerId}&name=${encodeURIComponent(customerName)}&type=${paymentType || 'adopt'}`;
                } else {
                    alert('Payment simulation failed. Please try again.');
                    paymentForm.classList.remove('hidden');
                    processingState.classList.add('hidden');
                }
            } catch (err) {
                console.error(err);
                alert('Error connecting to server.');
                paymentForm.classList.remove('hidden');
                processingState.classList.add('hidden');
            }
        }
    </script>
</body>

</html>